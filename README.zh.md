# Anamnesis

[English](./README.md) | [中文]

---

## **1. 产品愿景与概述**

**产品名称：** Anamnesis  
**核心理念：** 一个纯粹的、用户主权至上的 Web3 静态文件存储器。其名称源于柏拉图哲学中的“灵魂回忆说”，寓意此工具帮助用户的数字灵魂找回并永久守护那些本应永恒的记忆与数据。  
**产品定位：** 一个纯前端的应用。它允许用户直接使用 Arweave 钱包身份，在一个界面内自由选择将文件**永久刻录**在 Arweave 公链上，或**私密封存**在 Irys 存储网络，并形成完整的“身份 - 存储 - 检索”闭环。  
**目标用户：**

1.  **Web3 原生用户**：拥有 Arweave 钱包，寻求简单统一界面来管理跨协议存储。
2.  **Web3 好奇者**：无钱包，但愿意在应用内创建第一个自托管的 Arweave 钱包，体验真正的数据主权。
3.  **创作者与存档者**：有永久存档数字资产（如 NFT 元数据、作品源文件）或私密存储敏感文档的需求。

## **2. 核心用户流程与闭环**

整个产品体验围绕三个核心闭环构建：**账户钱包管理 -> 存储与资源管理 -> 资源查找与下载**。

## **3. 详细功能需求 (FRD)**

### **3.1 模块一：账户钱包管理**

此模块是产品的一切基础，负责建立和管理用户的唯一身份。

| 功能点                   | 描述                                                         | 验收标准                                                                                                                         |
| :----------------------- | :----------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------- |
| **FR1.1 创建钱包**       | 为用户在**浏览器前端**生成全新的 Arweave 钱包密钥对（JWK）。 | 1. 使用 `arweave-js` 安全生成。<br>2. **强制、不可跳过**的助记词/Keystore 文件备份流程。<br>3. 清晰警示私钥丢失即丢失所有数据。  |
| **FR1.2 导入钱包**       | 允许用户通过上传 Keystore 文件或输入助记词，导入已有钱包。   | 1. 支持标准 JSON 密钥文件。<br>2. 助记词输入有验证机制。<br>3. 导入后能正常显示地址和余额。                                      |
| **FR1.3 连接钱包**       | 支持与 ArConnect 等浏览器扩展钱包连接。                      | 1. 点击后唤起扩展授权。<br>2. 成功连接后显示钱包地址和网络信息。                                                                 |
| **FR1.4 钱包切换与管理** | 允许用户在多个已导入/创建的钱包间切换，并管理本地钱包列表。  | 1. UI 上有清晰的钱包切换器。<br>2. 可对本地钱包进行别名设置、删除（仅删除本地引用）操作。<br>3. 当前活跃钱包地址在全局显眼展示。 |
| **FR1.5 余额查看**       | 显示当前活跃钱包在 Arweave 和 Irys 网络上的原生代币余额。    | 1. 分别显示 AR 和 Irys 信用余额。<br>2. 余额信息随时间自动更新。                                                                 |

### **3.2 模块二：存储、展示与资源管理**

此模块是产品的核心价值，处理数据的“存”与“管”。

| 功能点                       | 描述                                                                                 | 验收标准                                                                                                                          |
| :--------------------------- | :----------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------- |
| **FR2.1 文件选择与预处理**   | 用户选择文件后，前端计算其哈希，用于唯一标识。                                       | 支持拖拽和文件选择器。                                                                                                            |
| **FR2.2 强制前端加密**       | 在上传前，**必须**使用当前活跃钱包的公钥或派生的对称密钥，在浏览器内对文件进行加密。 | 1. 明文绝不离端。<br>2. 使用可靠的加密库（如 libsodium）。<br>3. 加密算法和参数作为元数据保存。                                   |
| **FR2.3 存储方案选择**       | 用户选择将加密后的文件上传至 Arweave 或 Irys。                                       | 1. 界面清晰区分两者：**Arweave（永久/一次付费）** vs **Irys（私密/灵活扩展）**。<br>2. 有简明的特性对比说明。                     |
| **FR2.4 支付与上传**         | 集成 Bundlr Network，处理支付并上传数据。                                            | 1. 根据用户选择，调用对应 Bundlr 节点。<br>2. 支持使用 AR、ETH、MATIC 等多币种支付费用。<br>3. 显示实时上传进度和交易确认状态。   |
| **FR2.5 上传记录与资源管理** | 上传成功后，在本地（IndexedDB）创建一条文件记录，并在 UI 上展示。                    | 记录需包含：txid, 原文件名, 文件哈希, 存储方案, 上传时间, 加密信息, 所属钱包地址。                                                |
| **FR2.6 统一资源仪表板**     | 展示由当前活跃钱包上传的所有文件的统一视图。                                         | 1. 支持按文件名、存储方案、时间筛选排序。<br>2. 清晰标示每个文件的存储来源。<br>3. 仪表板数据通过查询链上交易与本地记录同步生成。 |

### **3.3 模块三：资源查找与下载**

此模块是产品的价值闭环，处理数据的“取”。

| 功能点                   | 描述                                             | 验收标准                                                                  |
| :----------------------- | :----------------------------------------------- | :------------------------------------------------------------------------ |
| **FR3.1 链上交易查询**   | 应用启动或切换钱包时，主动扫描网络查询相关交易。 | 1. 用于同步和验证本地文件记录。<br>2. 提供查询状态反馈。                  |
| **FR3.2 下载触发与验证** | 点击下载时，验证当前活跃钱包是否为文件所有者。   | 1. 对比 `ownerAddress`。<br>2. 阻止下载并提示切换钱包。                   |
| **FR3.3 获取与本地解密** | 从存储网络获取加密数据并在浏览器内解密。         | 1. 从正确网关获取。<br>2. 使用匹配算法解密。<br>3. 内存解密，私钥不外传。 |
| **FR3.4 文件交付**       | 将解密数据转换为文件并触发下载。                 | 1. 恢复原名称和格式。<br>2. 处理大文件进度。                              |

## **4. 安全架构与性能设计**

### **4.1 钱包与账户安全**

- **私钥零接触原则**：私钥永远仅存在于本地，不触及服务器。
- **安全的本地存储**：IndexedDB 中的密钥使用用户提供的**主密码**进行二次加密。
- **无状态会话**：关闭页面即“登出”。
- **清晰的用户教育**：强提示私钥安全和备份责任。

### **4.2 上传过程安全**

- **端到端加密（E2EE）**：强制本地加密 (XChaCha20-Poly1305)。
- **元数据保护**：敏感元数据在上传前加密。
- **支付安全**：签名在受信任环境中完成。

### **4.3 下载与解密安全**

- **所有权验证**：严格校验。
- **内存中解密**：解密后数据在内存中短暂存在。
- **密钥隔离**：解密私钥来源于当前会话钱包。

## **5. 部署与技术栈说明**

- **架构**: 纯静态 React SPA。
- **核心依赖**: `arweave-js`, `@irys/sdk`, `libsodium-wrappers`, `dexie`.

---

**文档核心闭环确认：**
本 PRD 所描述的流程已构成一个完整、安全且用户主权的 Web3 数据存储闭环。
